<div>
    <div class="flex flex-col">
        <div class="">
            <div class="relative top-7 w-full flex justify-between">
                <p class="text-3xl bg-gray-100 w-fit p-2 rounded-t-2xl border-x-2 border-t-2 border-gray-300">
                    Status</p>
                <div class="relative right-5 flex flex-col justify-end min-h-full mb-1 w-96">
                    <form class="w-full mx-auto" (submit)="search($event, searchInput.value)">
                        <label for="default-search"
                               class="mb-2 text-sm font-medium text-gray-900 sr-only dark:text-white">Search</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                                <mat-icon>search</mat-icon>
                            </div>
                            <input type="search" id="default-search" #searchInput
                                   class="block w-full p-4 ps-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                                   placeholder="Search Mockups, Logos..." required/>
                            <button type="submit"
                                    class="text-white absolute end-2.5 bottom-2.5 bg-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-4 py-2">
                                Search
                            </button>
                        </div>
                    </form>

                </div>
            </div>
            <div class="flex justify-between bg-gray-100 p-4 pt-6 rounded-2xl mb-16 border-gray-300 border-2">
                <div class="mx-8">
                    <div class="flex gap-8">
                        <div class="flex gap-3">
                            <p class="text-base">Airing: </p>
                            @if (isNumber(countAiringItems(filteredItems))) {
                                <span class="text-base text-mono text-gray-500">{{ countAiringItems(filteredItems) }}</span>
                            } @else {
                                <span class="text-base text-gray-500">{{ countAiringItems(filteredItems) }}</span>
                            }
                        </div>
                        <div class="flex gap-3">
                            <p class="text-base transition-all duration-300">Finished: </p>
                            @if (isNumber(countFinishedItems(filteredItems))) {
                                <span
                                        class="text-base text-mono text-gray-500 transition-all duration-300">{{ countFinishedItems(filteredItems) }}</span>
                            } @else {
                                <span
                                        class="text-base text-gray-500 transition-all duration-300">{{ countFinishedItems(filteredItems) }}</span>
                            }
                        </div>
                        <div class="flex gap-3">
                            <p class="text-base">Total tests: </p>
                            <span
                                    class="text-base text-gray-500 transition-all duration-300">{{ countTotalTests(filteredItems) }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    @if (!isRequesting) {
        <div (click)="disableContextMenu()" oncontextmenu="return false;">
            <div class="overflow-x-auto">
                <table class="table">
                    <!-- head -->
                    <thead>
                    <tr>
                        <th></th>
                        <th (click)="sort('values.date')" class="cursor-pointer">Date</th>
                        <th (click)="sort('name')" class="cursor-pointer">Filename</th>
                        <th (click)="sort('values.process.status')" class="cursor-pointer">Process</th>
                        <th (click)="sort('values.testData.testPass')" class="cursor-pointer">Tests passed</th>
                        <th (click)="sort('values.testData.testFail')" class="cursor-pointer">Faild Tests</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr class="hover" *ngFor="let item of filteredItems" (contextmenu)="onrightClick($event)"
                        (mouseenter)="selectedHistoryData = item">
                        <th>{{ item.index }}</th>
                        <td>{{ item.values.date }} {{ item.values.time }}</td>
                        <td>{{ item.name }}</td>
                        <td>
                            <div class="flex flex-row text-green-500"
                                 *ngIf="item.values.process.status === 'Finished'; else isNotFinished">
                                <div class="mr-2">
                                    <mat-icon>check_circle</mat-icon>
                                </div>
                                <span class="mt-0.5">Finished</span>
                            </div>

                            <ng-template #isNotFinished>
                                <div class="flex flex-row text-orange-600">
                                    <div class="mr-2">
                                        <mat-icon>autorenew</mat-icon>
                                    </div>
                                    <span class="mt-0.5">Airing</span>
                                </div>
                            </ng-template>
                        </td>
                        <td>
                            <div class="badge badge-success gap-2"
                                 *ngIf="item.values.testData.testPass === item.values.testData.testCount; else isNotTheSame">
                                <span>{{ item.values.testData.testPass }}</span>/
                                <span>{{ item.values.testData.testCount }}</span>
                            </div>
                            <ng-template #isNotTheSame>
                                <div class="badge badge-warning gap-2">
                                    <span>{{ item.values.testData.testPass }}</span>/
                                    <span>{{ item.values.testData.testCount }}</span>
                                </div>
                            </ng-template>
                        </td>
                        <td>
                            <div class="badge badge-success gap-2"
                                 *ngIf="item.values.testData.testFail === 0; else isNotTheSame2">
                                <span>0</span>/ <span>{{ item.values.testData.testCount }}</span>
                            </div>
                            <ng-template #isNotTheSame2>
                                <div class="badge badge-warning gap-2"
                                     *ngIf="item.values.testData.testFail <= item.values.testData.testCount / 2; else isMoreThanHalf">
                                    <span>{{ item.values.testData.testFail }}</span>/
                                    <span>{{ item.values.testData.testCount }}</span>
                                </div>

                                <ng-template #isMoreThanHalf>
                                    <div class="badge badge-error gap-2">
                                        <span>{{ item.values.testData.testFail }}</span>/
                                        <span>{{ item.values.testData.testCount }}</span>
                                    </div>
                                </ng-template>

                            </ng-template>
                        </td>
                        <td>
                            <button
                                    class="block text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
                                    type="button" class="text-blue-500 cursor-pointer" id="detailedInfoBtn"
                                    (click)="openModal(item)">Visit
                            </button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <div *ngIf="showModal">
                <app-detailed-history-modal [selectedHistoryData]="selectedHistoryData"
                                            (isModalClosed)="closeModal()"></app-detailed-history-modal>
            </div>

            <!--you have to write this only once in your component-->
            <div *ngIf="contextmenu">
                <app-contextmenu [x]="contextmenuX" [y]="contextmenuY"
                                 [items]='[{ "text": "Go to home", "url": "/"},{ "text": "Detailed Information", "url": "/dashboard/history/#detailedInfo?id=" + hoveredHistoryData},{ "text": "Download", "url": "/kawas"}]'></app-contextmenu>
            </div>
        </div>
    } @else {
        <div class="flex flex-col justify-center items-center">
            <span class="loading loading-spinner loading-lg"></span>
        </div>
    }
</div>
